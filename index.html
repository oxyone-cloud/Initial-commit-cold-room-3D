<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Oxyone - Digital Twin Hypermarket Logistics</title>
    <style>
        body { margin: 0; overflow: hidden; background: #050505; font-family: 'Segoe UI', sans-serif; color: white; }
        
        /* Panel Supervision (Gauche) */
        #ui-panel {
            position: absolute; top: 20px; left: 20px;
            background: rgba(10, 10, 10, 0.95); padding: 20px; border-radius: 12px; 
            border: 2px solid #00aaff; z-index: 100; width: 320px; box-shadow: 0 0 20px rgba(0,170,255,0.4);
        }
        
        /* Contact & Label (Droite) */
        #contact-info {
            position: absolute; top: 20px; right: 20px;
            text-align: right; background: rgba(0, 0, 0, 0.7); padding: 15px;
            border-radius: 8px; border-right: 4px solid #00aaff; z-index: 100;
        }
        .contact-text { font-size: 13px; color: #00aaff; font-weight: bold; margin-bottom: 3px; }
        .startup-label { font-size: 11px; color: #888; margin-top: 8px; font-style: italic; }

        .control-group { margin-bottom: 15px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px; }
        .label { font-size: 10px; color: #aaa; text-transform: uppercase; letter-spacing: 1px; }
        .value { font-size: 20px; font-weight: bold; color: #00aaff; margin-bottom: 5px; }
        .status-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 10px; }
        .unit-indicator { font-size: 10px; padding: 6px; border-radius: 4px; text-align: center; border: 1px solid #333; font-weight: bold; }
        .ok { color: #00ff88; border-color: #00ff88; background: rgba(0,255,136,0.1); }
        .warn { color: #ff4444; border-color: #ff4444; background: rgba(255,68,68,0.2); animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
        input { width: 100%; cursor: pointer; accent-color: #00aaff; }
        h2 { margin: 0 0 5px 0; font-size: 16px; color: #00aaff; text-transform: uppercase; }
        .sub-h2 { font-size: 9px; color: #888; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; }
    </style>
</head>
<body>
    <div id="ui-panel">
        <h2>Oxyone Fleet Manager</h2>
        <div class="sub-h2">Architecture Grande Distribution - Hypermarché</div>
        
        <div class="control-group">
            <div class="label">Température Moyenne (°C)</div>
            <div id="tVal" class="value">2.0°C</div>
            <input type="range" id="tSlider" min="-10" max="25" value="2">
        </div>

        <div class="control-group">
            <div class="label">Charge Volumique (kg/m³)</div>
            <div id="wVal" class="value">120 kg/m³</div>
            <input type="range" id="wSlider" min="0" max="500" value="120">
        </div>

        <div class="label">Statut des Modules RTLS</div>
        <div class="status-grid">
            <div id="u1" class="unit-indicator ok">UNIT-01</div>
            <div id="u2" class="unit-indicator ok">UNIT-02</div>
            <div id="u3" class="unit-indicator ok">UNIT-03</div>
        </div>
    </div>

    <div id="contact-info">
        <div class="contact-text">benhamamouchothman@gmail.com</div>
        <div class="contact-text">+213 782 09 02 81</div>
        <div class="startup-label">Startup Labellisée @ 2021</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        camera.position.set(15, 12, 18);

        scene.add(new THREE.AmbientLight(0xffffff, 0.4));
        const light = new THREE.DirectionalLight(0xffffff, 1); light.position.set(10, 25, 10); scene.add(light);

        // --- SOL LOGISTIQUE ---
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(120, 120), new THREE.MeshStandardMaterial({color: 0x111111}));
        floor.rotation.x = -Math.PI/2; scene.add(floor);
        scene.add(new THREE.GridHelper(100, 40, 0x333333, 0x222222));

        // --- RACKS SUR LES COTÉS (Architecture Hypermarché) ---
        function createSideRack(x, z) {
            const group = new THREE.Group();
            const frameMat = new THREE.MeshStandardMaterial({color: 0x444444, metalness: 0.8});
            for(let i=0; i<2; i++) {
                const post = new THREE.Mesh(new THREE.BoxGeometry(0.15, 6, 0.15), frameMat);
                post.position.set(i*1.5 - 0.75, 3, 0); group.add(post);
            }
            for(let h=1.5; h<=6; h+=1.8) {
                const shelf = new THREE.Mesh(new THREE.BoxGeometry(1.6, 0.1, 4), frameMat);
                shelf.position.y = h; group.add(shelf);
                // Palettes sur les racks
                const pal = new THREE.Mesh(new THREE.BoxGeometry(1.2, 0.8, 1.2), new THREE.MeshStandardMaterial({color: 0xdd8822}));
                pal.position.set(0, h+0.4, (Math.random()-0.5)*2.5); group.add(pal);
            }
            group.position.set(x, 0, z); scene.add(group);
        }

        // Placement des racks "entre" et "sur les côtés" des cubes
        // Cubes à x = -6, 0, 6. Racks aux x = -9, -3, 3, 9
        [-9.5, -3, 3, 9.5].forEach(posX => {
            createSideRack(posX, 0); // Racks alignés avec les côtés des cubes
        });

        // --- PARAMÈTRES UNITÉS OXYONE ---
        const L = 2.74, W = 1.83, H = 2.0;
        const fleet = [];

        function createUnit(posX, id) {
            const unitGroup = new THREE.Group();
            
            // 1. Structure
            const metalMat = new THREE.MeshStandardMaterial({color: 0x999999, metalness: 0.9});
            const beam = (w,h,d,x,y,z) => {
                const b = new THREE.Mesh(new THREE.BoxGeometry(w,h,d), metalMat);
                b.position.set(x,y,z); unitGroup.add(b);
            };
            [[-L/2, W/2], [L/2, W/2], [-L/2, -W/2], [L/2, -W/2]].forEach(p => beam(0.12, H, 0.12, p[0], H/2, p[1]));
            beam(L, 0.1, 0.1, 0, H, W/2); 

            // 2. Chambre
            const chamberMat = new THREE.MeshStandardMaterial({color: 0x00aaff, transparent: true, opacity: 0.2});
            const body = new THREE.Mesh(new THREE.BoxGeometry(L, H, W), chamberMat);
            body.position.y = H/2; unitGroup.add(body);

            // 3. PORTE (Indispensable)
            const door = new THREE.Mesh(new THREE.BoxGeometry(1.0, 1.85, 0.12), new THREE.MeshStandardMaterial({color: 0x222222}));
            door.position.set(0, 0.92, W/2 + 0.05); unitGroup.add(door);

            // 4. Etagères Internes
            for(let h=0.4; h<H; h+=0.6) {
                const shelf = new THREE.Mesh(new THREE.BoxGeometry(0.7, 0.05, W*0.8), metalMat);
                shelf.position.set(-L/2 + 0.45, h, 0); unitGroup.add(shelf);
            }

            // 5. Evaporateur & Airflow
            const evap = new THREE.Mesh(new THREE.BoxGeometry(1.2, 0.4, 0.7), new THREE.MeshStandardMaterial({color: 0xeeeeee}));
            evap.position.set(0, H - 0.3, -W/2 + 0.45); unitGroup.add(evap);
            
            const particles = new THREE.Group();
            for(let i=0; i<30; i++) {
                const p = new THREE.Mesh(new THREE.SphereGeometry(0.02), new THREE.MeshBasicMaterial({color: 0x00ffff, transparent: true, opacity: 0.5}));
                p.position.set((Math.random()-0.5), Math.random()*H, -W/2+0.6);
                particles.add(p);
            }
            unitGroup.add(particles);

            // 6. Zone Bluetooth (Au sol devant la porte)
            const btZone = new THREE.Mesh(
                new THREE.RingGeometry(1.3, 1.5, 32),
                new THREE.MeshBasicMaterial({color: 0x00ffff, transparent: true, opacity: 0.7, side: 2})
            );
            btZone.rotation.x = -Math.PI/2; btZone.position.set(0, 0.05, W/2 + 2.5);
            unitGroup.add(btZone);

            unitGroup.position.x = posX;
            scene.add(unitGroup);
            fleet.push({group: unitGroup, particles, chamberMat, btZone, id});
        }

        // Créer les 3 unités
        createUnit(-6.2, 'u1'); createUnit(0, 'u2'); createUnit(6.2, 'u3');

        // --- ANIMATION ET UI ---
        const tSlider = document.getElementById('tSlider');
        const wSlider = document.getElementById('wSlider');

        function animate() {
            requestAnimationFrame(animate);
            const t = Date.now() * 0.001;

            document.getElementById('tVal').innerText = tSlider.value + ".0°C";
            document.getElementById('wVal').innerText = wSlider.value + " kg/m³";

            fleet.forEach((u, i) => {
                // Flux d'air
                u.particles.children.forEach(p => {
                    p.position.y -= 0.035;
                    if(p.position.y < 0.1) p.position.y = H - 0.3;
                });

                // Zone BT
                u.btZone.material.opacity = 0.2 + Math.abs(Math.sin(t * 1.5 + i)) * 0.5;

                // Statut Alertes
                const indicator = document.getElementById(u.id);
                if(wSlider.value > 250 || tSlider.value > 18) {
                    u.chamberMat.color.setHex(0xff3333);
                    indicator.className = "unit-indicator warn";
                } else {
                    u.chamberMat.color.setHex(0x00aaff);
                    indicator.className = "unit-indicator ok";
                }
            });

            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
