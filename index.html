<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Oxyone - Multi-Unit Digital Twin</title>
    <style>
        body { margin: 0; overflow: hidden; background: #050505; font-family: 'Segoe UI', sans-serif; color: white; }
        #ui-panel {
            position: absolute; top: 20px; left: 20px;
            background: rgba(10, 10, 10, 0.95); padding: 20px; border-radius: 12px; 
            border: 2px solid #00aaff; z-index: 100; width: 300px;
        }
        .unit-status { padding: 8px; border-radius: 5px; background: #111; margin-bottom: 10px; border-left: 4px solid #00aaff; }
        .label { font-size: 10px; color: #888; text-transform: uppercase; }
        .value { font-size: 18px; font-weight: bold; color: #00aaff; margin-bottom: 5px; }
        .alert { padding: 5px; border-radius: 4px; text-align: center; font-weight: bold; font-size: 11px; margin-top: 5px; }
        .ok { background: rgba(0, 255, 136, 0.1); color: #00ff88; border: 1px solid #00ff88; }
        .danger { background: rgba(255, 68, 68, 0.2); color: #ff4444; border: 1px solid #ff4444; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
        input { width: 100%; cursor: pointer; accent-color: #00aaff; }
        h3 { margin: 0 0 15px 0; color: #00aaff; font-size: 16px; text-align: center; }
    </style>
</head>
<body>
    <div id="ui-panel">
        <h3>CENTRAL DE SUPERVISION</h3>
        
        <div id="unit-ctrl">
            <div class="label">Contrôle Global Flotte</div>
            <div class="value" id="globalWeight">100 kg/m²</div>
            <input type="range" id="wSlider" min="0" max="500" value="100">
        </div>
        <hr style="border: 0.5px solid #333; margin: 15px 0;">
        
        <div class="unit-status">
            <div class="label">UNITÉ 01 - ZONE A</div>
            <div id="st1" class="alert ok">NOMINAL</div>
        </div>
        <div class="unit-status">
            <div class="label">UNITÉ 02 - ZONE B</div>
            <div id="st2" class="alert ok">NOMINAL</div>
        </div>
        <div class="unit-status">
            <div class="label">UNITÉ 03 - ZONE C</div>
            <div id="st3" class="alert ok">NOMINAL</div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        camera.position.set(15, 12, 20);

        scene.add(new THREE.AmbientLight(0xffffff, 0.5));
        const sun = new THREE.DirectionalLight(0xffffff, 1);
        sun.position.set(20, 30, 10); scene.add(sun);

        // --- ENVIRONNEMENT ---
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(100, 100), new THREE.MeshStandardMaterial({color: 0x1a1a1a}));
        floor.rotation.x = -Math.PI/2; scene.add(floor);
        scene.add(new THREE.GridHelper(100, 40, 0x333333, 0x222222));

        // --- PARAMETRES ---
        const L = 2.74, W = 1.83, H = 2.0;
        const rooms = [];

        function createColdRoom(posX) {
            const group = new THREE.Group();
            
            // 1. Chambre
            const mat = new THREE.MeshStandardMaterial({ color: 0x00aaff, transparent: true, opacity: 0.2 });
            const chamber = new THREE.Mesh(new THREE.BoxGeometry(L, H, W), mat);
            chamber.position.y = H/2; group.add(chamber);

            // 2. Structure Métallique
            const metal = new THREE.MeshStandardMaterial({ color: 0x888888, metalness: 0.8 });
            function beam(w, h, d, x, y, z) {
                const b = new THREE.Mesh(new THREE.BoxGeometry(w, h, d), metal);
                b.position.set(x, y, z); group.add(b);
            }
            [[-L/2, W/2], [L/2, W/2], [-L/2, -W/2], [L/2, -W/2]].forEach(p => beam(0.1, H, 0.1, p[0], H/2, p[1]));
            beam(L, 0.1, 0.1, 0, H, W/2); beam(L, 0.1, 0.1, 0, H, -W/2);
            beam(L, 0.05, 0.05, 0, 0, W/2); // Base

            // 3. Porte & Evaporateur
            const door = new THREE.Mesh(new THREE.BoxGeometry(0.9, 1.8, 0.1), new THREE.MeshStandardMaterial({color: 0x111111}));
            door.position.set(0, 0.9, W/2); group.add(door);
            
            const evap = new THREE.Mesh(new THREE.BoxGeometry(1.2, 0.4, 0.6), new THREE.MeshStandardMaterial({color: 0xeeeeee}));
            evap.position.set(0, H - 0.3, -W/2 + 0.4); group.add(evap);

            // 4. Etagères
            for(let h=0.5; h<H; h+=0.6) {
                const sL = new THREE.Mesh(new THREE.BoxGeometry(0.6, 0.05, W*0.8), metal);
                sL.position.set(-L/2 + 0.4, h, 0); group.add(sL);
            }

            // 5. Air (Particules)
            const particles = new THREE.Group();
            for(let i=0; i<30; i++) {
                const p = new THREE.Mesh(new THREE.SphereGeometry(0.02), new THREE.MeshBasicMaterial({color: 0x00ffff, transparent: true, opacity: 0.5}));
                p.position.set(Math.random()*0.8-0.4, Math.random()*H, -W/2+0.5);
                particles.add(p);
            }
            group.add(particles);

            // 6. Zone Bluetooth
            const bt = new THREE.Mesh(new THREE.CircleGeometry(1.5, 32), new THREE.MeshBasicMaterial({color: 0x00aaff, transparent: true, opacity: 0.3, side: 2}));
            bt.rotation.x = -Math.PI/2; bt.position.set(0, 0.05, W/2 + 2); group.add(bt);

            group.position.x = posX;
            scene.add(group);
            return { group, particles, mat, bt };
        }

        // Créer les 3 cubes
        rooms.push(createColdRoom(-6));
        rooms.push(createColdRoom(0));
        rooms.push(createColdRoom(6));

        // --- RACKS EXTERIEURS ---
        function addWarehouseRack(x, z) {
            const rack = new THREE.Mesh(new THREE.BoxGeometry(4, 5, 1.5), new THREE.MeshStandardMaterial({color: 0x333333, wireframe: true}));
            rack.position.set(x, 2.5, z); scene.add(rack);
        }
        for(let i=-10; i<=10; i+=10) addWarehouseRack(i, -8);

        // --- ANIMATION & LOGIQUE ---
        const slider = document.getElementById('wSlider');
        const weightLabel = document.getElementById('globalWeight');

        function animate() {
            requestAnimationFrame(animate);
            const time = Date.now() * 0.001;
            const w = slider.value;
            weightLabel.innerText = w + " kg/m²";

            rooms.forEach((room, index) => {
                // Animation air
                room.particles.children.forEach(p => {
                    p.position.y -= 0.03;
                    if(p.position.y < 0.1) p.position.y = H - 0.2;
                });

                // Alerte individuelle
                const statusDiv = document.getElementById(`st${index+1}`);
                if(w > 250) {
                    statusDiv.innerText = "ALERTE SURCHARGE";
                    statusDiv.className = "alert danger";
                    room.mat.color.setHex(0xff4444);
                } else {
                    statusDiv.innerText = "NOMINAL";
                    statusDiv.className = "alert ok";
                    room.mat.color.setHex(0x00aaff);
                }
                
                // Effet zone BT
                room.bt.material.opacity = 0.2 + Math.abs(Math.sin(time + index)) * 0.2;
            });

            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
