<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Oxyone - Digital Twin Hypermarché</title>
    <style>
        body { margin: 0; overflow: hidden; background: #050505; font-family: 'Segoe UI', sans-serif; color: white; }
        #ui-panel {
            position: absolute; top: 20px; left: 20px;
            background: rgba(10, 10, 10, 0.95); padding: 20px; border-radius: 12px; 
            border: 2px solid #00aaff; z-index: 100; width: 320px; box-shadow: 0 0 20px rgba(0,170,255,0.4);
        }
        .control-group { margin-bottom: 15px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px; }
        .label { font-size: 10px; color: #aaa; text-transform: uppercase; letter-spacing: 1px; }
        .value { font-size: 20px; font-weight: bold; color: #00aaff; margin-bottom: 5px; }
        .status-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 10px; }
        .unit-indicator { font-size: 10px; padding: 6px; border-radius: 4px; text-align: center; border: 1px solid #333; font-weight: bold; }
        .ok { color: #00ff88; border-color: #00ff88; background: rgba(0,255,136,0.1); }
        .warn { color: #ff4444; border-color: #ff4444; background: rgba(255,68,68,0.2); animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
        input { width: 100%; cursor: pointer; accent-color: #00aaff; }
        h2 { margin: 0 0 15px 0; font-size: 16px; color: #00aaff; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 10px; }
    </style>
</head>
<body>
    <div id="ui-panel">
        <h2>Oxyone Fleet Manager</h2>
        
        <div class="control-group">
            <div class="label">Température Flotte (°C)</div>
            <div id="tVal" class="value">2.0°C</div>
            <input type="range" id="tSlider" min="-10" max="25" value="2">
        </div>

        <div class="control-group">
            <div class="label">Densité Moyenne (kg/m²)</div>
            <div id="wVal" class="value">120 kg/m²</div>
            <input type="range" id="wSlider" min="0" max="500" value="120">
        </div>

        <div class="label">Statut Temps Réel</div>
        <div class="status-grid">
            <div id="u1" class="unit-indicator ok">UNIT-01</div>
            <div id="u2" class="unit-indicator ok">UNIT-02</div>
            <div id="u3" class="unit-indicator ok">UNIT-03</div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        camera.position.set(12, 10, 15);

        scene.add(new THREE.AmbientLight(0xffffff, 0.5));
        const light = new THREE.DirectionalLight(0xffffff, 1); light.position.set(10, 20, 10); scene.add(light);

        // --- SOL ET GRILLE ---
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(100, 100), new THREE.MeshStandardMaterial({color: 0x151515}));
        floor.rotation.x = -Math.PI/2; scene.add(floor);
        scene.add(new THREE.GridHelper(100, 50, 0x333333, 0x222222));

        // --- RACKS EXTERIEURS (ENTREPOT) ---
        function createLargeRack(x, z) {
            const group = new THREE.Group();
            const frameMat = new THREE.MeshStandardMaterial({color: 0x444444, metalness: 0.8});
            for(let i=0; i<2; i++) {
                const post = new THREE.Mesh(new THREE.BoxGeometry(0.15, 6, 0.15), frameMat);
                post.position.set(i*4-2, 3, 0); group.add(post);
            }
            for(let h=1.5; h<=6; h+=2) {
                const shelf = new THREE.Mesh(new THREE.BoxGeometry(4.2, 0.1, 1.2), frameMat);
                shelf.position.y = h; group.add(shelf);
                // Palettes sur les racks
                const pal = new THREE.Mesh(new THREE.BoxGeometry(1, 0.7, 1), new THREE.MeshStandardMaterial({color: Math.random()*0xffffff}));
                pal.position.set((Math.random()-0.5)*3, h+0.4, 0); group.add(pal);
            }
            group.position.set(x, 0, z); scene.add(group);
        }
        for(let x=-15; x<=15; x+=10) { if(Math.abs(x)>4) createLargeRack(x, -5); createLargeRack(x, 5); }

        // --- PARAMÈTRES OXYONE ---
        const L = 2.74, W = 1.83, H = 2.0;
        const fleet = [];

        function createUnit(posX, id) {
            const unitGroup = new THREE.Group();
            
            // 1. Structure (Squelette)
            const metalMat = new THREE.MeshStandardMaterial({color: 0x888888, metalness: 0.9});
            const beam = (w,h,d,x,y,z) => {
                const b = new THREE.Mesh(new THREE.BoxGeometry(w,h,d), metalMat);
                b.position.set(x,y,z); unitGroup.add(b);
            };
            [[-L/2, W/2], [L/2, W/2], [-L/2, -W/2], [L/2, -W/2]].forEach(p => beam(0.1, H, 0.1, p[0], H/2, p[1]));
            beam(L, 0.1, 0.1, 0, H, W/2); beam(L, 0.1, 0.1, 0, H, -W/2);

            // 2. Chambre Froide (Transparente)
            const chamberMat = new THREE.MeshStandardMaterial({color: 0x00aaff, transparent: true, opacity: 0.2});
            const body = new THREE.Mesh(new THREE.BoxGeometry(L, H, W), chamberMat);
            body.position.y = H/2; unitGroup.add(body);

            // 3. LA PORTE (Enfin visible !)
            const doorGroup = new THREE.Group();
            const doorMain = new THREE.Mesh(new THREE.BoxGeometry(1.0, 1.85, 0.12), new THREE.MeshStandardMaterial({color: 0x2a2a2a, metalness: 0.5}));
            const handle = new THREE.Mesh(new THREE.BoxGeometry(0.05, 0.4, 0.05), new THREE.MeshStandardMaterial({color: 0xcccccc}));
            handle.position.set(0.35, 0, 0.1); doorMain.add(handle);
            doorGroup.add(doorMain);
            doorGroup.position.set(0, 0.95, W/2 + 0.05);
            unitGroup.add(doorGroup);

            // 4. Etagères Internes
            for(let h=0.4; h<H; h+=0.6) {
                const shelf = new THREE.Mesh(new THREE.BoxGeometry(0.7, 0.05, W*0.8), metalMat);
                shelf.position.set(-L/2 + 0.45, h, 0); unitGroup.add(shelf);
            }

            // 5. Evaporateur & Airflow
            const evap = new THREE.Mesh(new THREE.BoxGeometry(1.2, 0.4, 0.7), new THREE.MeshStandardMaterial({color: 0xeeeeee}));
            evap.position.set(0, H - 0.3, -W/2 + 0.45); unitGroup.add(evap);
            
            const particles = new THREE.Group();
            for(let i=0; i<30; i++) {
                const p = new THREE.Mesh(new THREE.SphereGeometry(0.02), new THREE.MeshBasicMaterial({color: 0x00ffff, transparent: true, opacity: 0.5}));
                p.position.set((Math.random()-0.5), Math.random()*H, -W/2+0.6);
                particles.add(p);
            }
            unitGroup.add(particles);

            // 6. Zone Bluetooth au sol
            const btZone = new THREE.Mesh(
                new THREE.RingGeometry(1.4, 1.6, 32),
                new THREE.MeshBasicMaterial({color: 0x00ffff, transparent: true, opacity: 0.6, side: 2})
            );
            btZone.rotation.x = -Math.PI/2; btZone.position.set(0, 0.06, W/2 + 2.5);
            unitGroup.add(btZone);

            unitGroup.position.x = posX;
            scene.add(unitGroup);
            fleet.push({group: unitGroup, particles, chamberMat, btZone, id});
        }

        // Créer les 3 unités alignées
        createUnit(-6, 'u1'); createUnit(0, 'u2'); createUnit(6, 'u3');

        // --- ANIMATION ET UI ---
        const tSlider = document.getElementById('tSlider');
        const wSlider = document.getElementById('wSlider');

        function animate() {
            requestAnimationFrame(animate);
            const t = Date.now() * 0.001;

            document.getElementById('tVal').innerText = tSlider.value + ".0°C";
            document.getElementById('wVal').innerText = wSlider.value + " kg/m²";

            fleet.forEach((u, i) => {
                // Flux d'air descendant
                u.particles.children.forEach(p => {
                    p.position.y -= 0.035;
                    if(p.position.y < 0.1) p.position.y = H - 0.4;
                });

                // Pulsation Zone BT
                u.btZone.material.opacity = 0.2 + Math.abs(Math.sin(t * 1.5 + i)) * 0.6;

                // Gestion des Alertes
                const indicator = document.getElementById(u.id);
                if(wSlider.value > 250 || tSlider.value > 15) {
                    u.chamberMat.color.setHex(0xff3333);
                    indicator.className = "unit-indicator warn";
                } else {
                    u.chamberMat.color.setHex(0x00aaff);
                    indicator.className = "unit-indicator ok";
                }
            });

            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
